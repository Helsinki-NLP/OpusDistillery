

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Configuration Files &mdash; OpusDistillery  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Dataset importers" href="downloading_and_selecting_data.html" />
    <link rel="prev" title="QuickStart Tutorial" href="../quickstart.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> OpusDistillery
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Get started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Basic Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">QuickStart Tutorial</a></li>
</ul>
<p class="caption"><span class="caption-text">Setting up your experiment</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Configuration Files</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#experiment-setup">Experiment Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="#data-processing">Data processing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#opusfilter">OpusFilter</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bicleaner-ai">Bicleaner AI</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#teacher-models">Teacher models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#opus-mt-teachers">OPUS-MT Teachers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hugging-face-teachers">Hugging Face Teachers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ctranslate2">CTranslate2</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#backward-models">Backward models</a></li>
<li class="toctree-l2"><a class="reference internal" href="#multilinguality">Multilinguality</a></li>
<li class="toctree-l2"><a class="reference internal" href="#training">Training</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#marian-arguments">Marian arguments</a></li>
<li class="toctree-l3"><a class="reference internal" href="#opustrainer">Opustrainer</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#exporting">Exporting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#other">Other</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="downloading_and_selecting_data.html">Dataset importers</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples of Configuration Files</a></li>
</ul>
<p class="caption"><span class="caption-text">The pipeline</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../pipeline/steps.html">Pipeline steps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pipeline/dir_structure.html">Directory structure</a></li>
</ul>
<p class="caption"><span class="caption-text">Other information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html">References</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">OpusDistillery</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Configuration Files</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="configuration-files">
<h1>Configuration Files<a class="headerlink" href="#configuration-files" title="Permalink to this headline">¶</a></h1>
<p>The configuration files for OpusDistillery are written in <a class="reference external" href="https://yaml.org/">YAML</a> format and are divided into two main sections:</p>
<ul class="simple">
<li><p><strong><code class="docutils literal notranslate"><span class="pre">experiment</span></code></strong>: Contains the general setup and parameters for the experiment, excluding dataset information.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">datasets</span></code></strong>: Specifies the datasets used for training, development, and evaluation. Details about datasets can be found in <a class="reference internal" href="downloading_and_selecting_data.html"><span class="doc std std-doc">Dataset Importers</span></a>.</p></li>
</ul>
<div class="section" id="experiment-setup">
<h2>Experiment Setup<a class="headerlink" href="#experiment-setup" title="Permalink to this headline">¶</a></h2>
<p>In the <code class="docutils literal notranslate"><span class="pre">experiment</span></code> section, the following key parameters must be defined:</p>
<ul class="simple">
<li><p><strong><code class="docutils literal notranslate"><span class="pre">dirname</span></code></strong>: The directory where all experiment outputs will be stored.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">name</span></code></strong>: The name of the experiment. All generated data and models will be saved under <code class="docutils literal notranslate"><span class="pre">dirname</span></code>/<code class="docutils literal notranslate"><span class="pre">name</span></code>.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">langpairs</span></code></strong>: A list of language pairs for the student model, using ISO two-letter language codes.</p></li>
</ul>
<p>Example configuration:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">experiment</span><span class="p">:</span>
<span class="w">  </span><span class="nt">dirname</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fiu-eng</span>
<span class="w">  </span><span class="nt">langpairs</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">et-en</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fi-en</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hu-en</span>
</pre></div>
</div>
</div>
<div class="section" id="data-processing">
<h2>Data processing<a class="headerlink" href="#data-processing" title="Permalink to this headline">¶</a></h2>
<div class="section" id="opusfilter">
<h3>OpusFilter<a class="headerlink" href="#opusfilter" title="Permalink to this headline">¶</a></h3>
<p>OpusDistillery supports <a class="reference external" href="https://github.com/Helsinki-NLP/OpusFilter">OpusFilter</a>, a tool for filtering and combining parallel corpora. Instead of the default cleaning, you can choose to filter data using OpusFilter with either a default configuration or a custom configuration that you provide.</p>
<p>In the configuration file, if you want to use a default configuration, see this <a class="reference external" href="https://github.com/Helsinki-NLP/OpusDistillery/blob/multi-ftt/configs/pipeline/clean/run-opusfilter.py#13">example</a>.
Otherwise, you can specify the path to a custom OpusFilter configuration file such as <a class="reference external" href="https://github.com/Helsinki-NLP/OpusDistillery/blob/multi-ftt/configs/configs/opusfilter/config.opusfilter.yml">this one</a>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="nt">opusfilter</span><span class="p">:</span>
<span class="w">    </span><span class="nt">config</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span><span class="w"> </span><span class="c1"># # Or specify the path to an OpusFilter configuration file</span>
</pre></div>
</div>
</div>
<div class="section" id="bicleaner-ai">
<h3>Bicleaner AI<a class="headerlink" href="#bicleaner-ai" title="Permalink to this headline">¶</a></h3>
<p>Currently, Bicleaner AI is not operational. Do you want to collaborate? Feel free to work on this <a class="reference external" href="https://github.com/Helsinki-NLP/OpusDistillery/issues/3">issue</a>.</p>
</div>
</div>
<div class="section" id="teacher-models">
<h2>Teacher models<a class="headerlink" href="#teacher-models" title="Permalink to this headline">¶</a></h2>
<p>You can select a teacher model from OPUS-MT or Hugging Face.</p>
<div class="section" id="opus-mt-teachers">
<h3>OPUS-MT Teachers<a class="headerlink" href="#opus-mt-teachers" title="Permalink to this headline">¶</a></h3>
<p>To specify an OPUS-MT teacher, use:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">opusmt-teacher</span></code></p></li>
</ul>
<p>It can be one of the following:</p>
<ol class="simple">
<li><p>A URL to an OPUS-MT model:</p></li>
</ol>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="nt">opusmt-teacher</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://object.pouta.csc.fi/Tatoeba-MT-models/fiu-eng/opus4m-2020-08-12.zip&quot;</span>
</pre></div>
</div>
<ol class="simple">
<li><p>A path to a local OPUS-MT model:</p></li>
</ol>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="nt">opusmt-teacher</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/path/to/opus-mt/model&quot;</span>
</pre></div>
</div>
<ol class="simple">
<li><p>A list of OPUS-MT models:</p></li>
</ol>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="nt">opusmt-teacher</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;https://object.pouta.csc.fi/Tatoeba-MT-models/gem-gem/opus-2020-10-04.zip&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;https://object.pouta.csc.fi/Tatoeba-MT-models/eng-swe/opus+bt-2021-04-14.zip&quot;</span>
</pre></div>
</div>
<ol class="simple">
<li><p>For multilingual students, specify different teachers for each language pair:</p></li>
</ol>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="nt">opusmt-teacher</span><span class="p">:</span>
<span class="w">    </span><span class="nt">en-uk</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://object.pouta.csc.fi/Tatoeba-MT-models/eng-ukr/opus+bt-2021-04-14.zip&quot;</span>
<span class="w">    </span><span class="nt">en-ru</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://object.pouta.csc.fi/Tatoeba-MT-models/eng-rus/opus+bt-2021-04-14.zip&quot;</span>
<span class="w">    </span><span class="nt">en-be</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://object.pouta.csc.fi/Tatoeba-MT-models/eng-bel/opus+bt-2021-03-07.zip&quot;</span>
</pre></div>
</div>
<ol class="simple">
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">best</span></code> option to automatically select the best teacher for each language pair, based on FLORES200+ scores from the <a class="reference external" href="https://opus.nlpl.eu/dashboard/">OPUS-MT dashboard</a>.</p></li>
</ol>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="nt">opusmt-teacher</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;best&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="hugging-face-teachers">
<h3>Hugging Face Teachers<a class="headerlink" href="#hugging-face-teachers" title="Permalink to this headline">¶</a></h3>
<p>You can also use a <a class="reference external" href="https://huggingface.co/">Hugging Face</a> model as a teacher.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">modelname</span></code>: The model identifier from the Hugging Face hub.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">modelclass</span></code>: The class of the model being loaded.</p></li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="nt">huggingface</span><span class="p">:</span>
<span class="w">    </span><span class="nt">modelname</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Helsinki-NLP/opus-mt-mul-en&quot;</span>
<span class="w">    </span><span class="nt">modelclass</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;transformers.AutoModelForSeq2SeqLM&quot;</span>
</pre></div>
</div>
<p>You can also configure the decoding options:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="nt">huggingface</span><span class="p">:</span>
<span class="w">    </span><span class="nt">modelname</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;HPLT/translate-et-en-v1.0-hplt_opus&quot;</span>
<span class="w">    </span><span class="nt">modelclass</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;transformers.AutoModelForSeq2SeqLM&quot;</span>
<span class="w">    </span><span class="nt">config</span><span class="p">:</span>
<span class="w">      </span><span class="nt">top_k</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">50</span>
<span class="w">      </span><span class="nt">top_p</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.90</span>
<span class="w">      </span><span class="nt">temperature</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.1</span>
<span class="w">      </span><span class="nt">max_new_tokens</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">128</span>
</pre></div>
</div>
<p>For models that use language tags, additional parameters are required:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">lang_info</span></code>: Set to True if language tags are needed.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lang_tags</span></code>: A mapping of language codes to the tags used by the model.</p></li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="nt">huggingface</span><span class="p">:</span>
<span class="w">    </span><span class="nt">modelname</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;facebook/nllb-200-distilled-600M&quot;</span>
<span class="w">    </span><span class="nt">modelclass</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;transformers.AutoModelForSeq2SeqLM&quot;</span>
<span class="w">    </span><span class="nt">lang_info</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="w">    </span><span class="nt">lang_tags</span><span class="p">:</span>
<span class="w">      </span><span class="nt">en</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eng_Latn</span>
<span class="w">      </span><span class="nt">et</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">est_Latn</span>
</pre></div>
</div>
<p>For gated models, you can provide your HF token as follows:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="nt">huggingface</span><span class="p">:</span>
<span class="w">    </span><span class="nt">modelname</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;facebook/nllb-200-distilled-600M&quot;</span>
<span class="w">    </span><span class="nt">modelclass</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;transformers.AutoModelForSeq2SeqLM&quot;</span>
<span class="w">    </span><span class="nt">token</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&lt;your-hf-token-here&gt;&quot;</span>
</pre></div>
</div>
<p>Finally, for models requiring a prompt, you can define it like this:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="nt">huggingface</span><span class="p">:</span>
<span class="w">    </span><span class="nt">modelname</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;google-t5/t5-small&quot;</span>
<span class="w">    </span><span class="nt">modelclass</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;transformers.AutoModelForSeq2SeqLM&quot;</span>
<span class="w">    </span><span class="nt">lang_tags</span><span class="p">:</span>
<span class="w">      </span><span class="nt">en</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">English</span>
<span class="w">      </span><span class="nt">de</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">German</span>
<span class="w">    </span><span class="nt">prompt</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Translate</span><span class="nv"> </span><span class="s">{src_lang}</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">{tgt_lang}:</span><span class="nv"> </span><span class="s">{source}&quot;</span>
</pre></div>
</div>
<p>In this case, the lang_tags mapping will be used in the prompt.</p>
<p>Note: When using a Hugging Face model as a teacher, there is no scoring or cross-entropy filtering.</p>
<div class="section" id="ctranslate2">
<h4>CTranslate2<a class="headerlink" href="#ctranslate2" title="Permalink to this headline">¶</a></h4>
<p>The pipeline also supports CTranslate2 inference for HuggingFace models, which provides a considerable speedup.
For that, simply add new boolean key:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">huggingface</span><span class="p">:</span>
<span class="w">    </span><span class="nt">modelname</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;facebook/nllb-200-distilled-1.3B&quot;</span>
<span class="w">    </span><span class="nt">lang_info</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="w">    </span><span class="nt">batch_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4096</span>
<span class="w">    </span><span class="nt">lang_tags</span><span class="p">:</span>
<span class="w">      </span><span class="nt">en</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eng_Latn</span>
<span class="w">      </span><span class="nt">ja</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">jpn_Jpan</span>
<span class="w">    </span><span class="nt">ct2</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
</pre></div>
</div>
<p>We have done some benchmarking on 4 Nvidia Ampere A100 GPUs that shows CTranslate2 provides a 26x faster inference:</p>
<div class="highlight-markdown notranslate"><div class="highlight"><pre><span></span>| Model                               | Type         | Batch size | Return sequences | Sent/s  |
|-------------------------------------|--------------|------------|------------------|---------|
| facebook/nllb-200-distilled-1.3B   | ctranslate2   | 8192       | 8                | 406,316 |
| facebook/nllb-200-distilled-1.3B   | huggingface  | 8          | 8                | 15,37   |
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="backward-models">
<h2>Backward models<a class="headerlink" href="#backward-models" title="Permalink to this headline">¶</a></h2>
<p>Currently, only OPUS-MT models are available as backward models for scoring translations.</p>
<p>To specify a backward model, use:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">opusmt-backward</span></code>: The URL or path to an OPUS-MT model. Like the teacher models, this can also be a dictionary for multilingual students or <code class="docutils literal notranslate"><span class="pre">best</span></code>.</p></li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="nt">opusmt-backward</span><span class="p">:</span>
<span class="w">    </span><span class="nt">uk-en</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://object.pouta.csc.fi/Tatoeba-MT-models/ukr-eng/opus+bt-2021-04-30.zip&quot;</span>
<span class="w">    </span><span class="nt">ru-en</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://object.pouta.csc.fi/Tatoeba-MT-models/rus-eng/opus+bt-2021-04-30.zip&quot;</span>
<span class="w">    </span><span class="nt">be-en</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://object.pouta.csc.fi/Tatoeba-MT-models/bel-eng/opus+bt-2021-04-30.zip&quot;</span>
</pre></div>
</div>
<p>If left empty, the cross-entropy filtering step will be skipped.</p>
</div>
<div class="section" id="multilinguality">
<h2>Multilinguality<a class="headerlink" href="#multilinguality" title="Permalink to this headline">¶</a></h2>
<p>Specify whether the teacher, backward, and student models are many-to-one to properly handle language tags. By default, this is set to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">one2many-teacher</span></code>: <code class="docutils literal notranslate"><span class="pre">True</span></code> or <code class="docutils literal notranslate"><span class="pre">False</span></code> (default). If <code class="docutils literal notranslate"><span class="pre">opusmt-teacher</span></code> is set to <code class="docutils literal notranslate"><span class="pre">best</span></code>, this should also be <code class="docutils literal notranslate"><span class="pre">best</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">one2many-backward</span></code>: <code class="docutils literal notranslate"><span class="pre">True</span></code> or <code class="docutils literal notranslate"><span class="pre">False</span></code> (default). If <code class="docutils literal notranslate"><span class="pre">opusmt-backward</span></code> is set to <code class="docutils literal notranslate"><span class="pre">best</span></code>, this should also be <code class="docutils literal notranslate"><span class="pre">best</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">one2many-student</span></code>: <code class="docutils literal notranslate"><span class="pre">True</span></code> or <code class="docutils literal notranslate"><span class="pre">False</span></code> (default).</p></li>
</ul>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Specify if the teacher and the student are one2many</span>
<span class="w">  </span><span class="nt">one2many-teacher</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="w">  </span><span class="nt">one2many-student</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
</pre></div>
</div>
</div>
<div class="section" id="training">
<h2>Training<a class="headerlink" href="#training" title="Permalink to this headline">¶</a></h2>
<div class="section" id="marian-arguments">
<h3>Marian arguments<a class="headerlink" href="#marian-arguments" title="Permalink to this headline">¶</a></h3>
<p>You can override default pipeline settings with <a class="reference external" href="https://marian-nmt.github.io/docs/cmd/marian/">Marian-specific settings</a>.</p>
<p>You can use the following options: <code class="docutils literal notranslate"><span class="pre">training-teacher</span></code>, <code class="docutils literal notranslate"><span class="pre">decoding-teacher</span></code>,<code class="docutils literal notranslate"><span class="pre">training-backward</span></code>, <code class="docutils literal notranslate"><span class="pre">decoding-backward</span></code>,<code class="docutils literal notranslate"><span class="pre">training-student</span></code>, <code class="docutils literal notranslate"><span class="pre">training-student-finetuned</span></code>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="nt">marian-args</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># These configs override pipeline/train/configs</span>
<span class="w">  </span><span class="nt">training-student</span><span class="p">:</span>
<span class="w">    </span><span class="nt">dec-depth</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="w">    </span><span class="nt">enc-depth</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="w">    </span><span class="nt">dim-emb</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">512</span>
<span class="w">    </span><span class="nt">tied-embeddings-all</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">transformer-decoder-autoreg</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rnn</span>
<span class="w">    </span><span class="nt">transformer-dim-ffn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2048</span>
<span class="w">    </span><span class="nt">transformer-ffn-activation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">relu</span>
<span class="w">    </span><span class="nt">transformer-ffn-depth</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">    </span><span class="nt">transformer-guided-alignment-layer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">last</span>
<span class="w">    </span><span class="nt">transformer-heads</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8</span>
<span class="w">    </span><span class="nt">transformer-postprocess</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dan</span>
<span class="w">    </span><span class="nt">transformer-preprocess</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">    </span><span class="nt">transformer-tied-layers</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
<span class="w">    </span><span class="nt">transformer-train-position-embeddings</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">transformer</span>
</pre></div>
</div>
</div>
<div class="section" id="opustrainer">
<h3>Opustrainer<a class="headerlink" href="#opustrainer" title="Permalink to this headline">¶</a></h3>
<p>OpusDistillery supports <a class="reference external" href="https://github.com/hplt-project/OpusTrainer">OpusTrainer</a> for curriculum training and data augmentation.</p>
<p>You can specify a path to the OpusTrainer configuration, such as in <a class="reference external" href="https://github.com/Helsinki-NLP/OpusDistillery/blob/multi-ftt/configs/opustrainer/config.fiu-eng.opustrainer.yml#L37">this example</a>.
This assumes you know the final paths of the data, as defined in <a class="reference external" href="https://github.com/Helsinki-NLP/OpusDistillery/blob/multi-ftt/configs/opustrainer/config.fiu-eng.opustrainer.stages.yml">this file</a>.</p>
<p>Currently, this is implemented only for student training.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="nt">opustrainer</span><span class="p">:</span>
<span class="w">    </span><span class="nt">model</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">student</span><span class="w"> </span><span class="c1"># Ideally, could be teacher or backward</span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;configs/opustrainer/config.fiu-eng.opustrainer.stages.yml&quot;</span><span class="w"> </span><span class="c1"># This assumes you already know the paths to the data</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="exporting">
<h2>Exporting<a class="headerlink" href="#exporting" title="Permalink to this headline">¶</a></h2>
<p>The final student model is exported in the Bergamot format, which uses shortlists for training. Shortlists are trained using alignments, so there’s an option to train a student without guided alignment using the tiny architecture. To disable this, specify export in the configuration file:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="nt">export</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;no&quot;</span>
</pre></div>
</div>
<div class="section" id="other">
<h3>Other<a class="headerlink" href="#other" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">parallel-max-sentences</span></code>: Maximum parallel sentences to download from each dataset.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">split-length</span></code>: The number of sentences into which you want to split your training data for forward translation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">best-model</span></code>: Metric used to select the best model.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">spm-sample-size</span></code>: Sample size for training the student’s SPM vocabulary.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">spm-vocab-size</span></code>: Vocabulary size for training the student’s SPM vocabulary.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">student-prefix</span></code>: To train multiple students with the same data, add a prefix to the student name, which will allow multiple students to be trained under the same directory structure with the same data. More details on the directory structure can be found <a class="reference internal" href="../pipeline/dir_structure.html"><span class="doc std std-doc">here</span></a>.</p></li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="downloading_and_selecting_data.html" class="btn btn-neutral float-right" title="Dataset importers" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../quickstart.html" class="btn btn-neutral float-left" title="QuickStart Tutorial" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>